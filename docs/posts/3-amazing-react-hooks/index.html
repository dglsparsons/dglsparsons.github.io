<!DOCTYPE html><html domain=dgls.dev ga-id=UA-177820617-1 lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href="/img/favicon/favicon.ico?hash=ba55cd0070" rel=icon><meta content=#f9c412 name=theme-color><title>3 amazing REACT HOOKS to keep your code organized neatly</title><meta content="dgls | dev" property=og:site_name><meta content=https://dgls.dev property=og:url><meta content="3 amazing REACT HOOKS to keep your code organized neatly" property=og:title><meta content=website property=og:type><meta content="3 amazing REACT HOOKS to keep your code organized neatly" property=twitter:title><meta content="Here are the three React Hooks I have found the most useful for producing websites in the cleanest, simplest way possible. They manage localStorage, sessionStorage, authentication and asynchronous tasks." name=description><meta content="Here are the three React Hooks I have found the most useful for producing websites in the cleanest, simplest way possible. They manage localStorage, sessionStorage, authentication and asynchronous tasks." property=og:description><meta content="Here are the three React Hooks I have found the most useful for producing websites in the cleanest, simplest way possible. They manage localStorage, sessionStorage, authentication and asynchronous tasks." property=twitter:description><meta content=summary_large_image name=twitter:card><meta content=@dglsparsons name=twitter:site><meta content=@dglsparsons name=twitter:creator><meta content=https://dgls.dev/img/remote/hooks.jpg property=twitter:image><meta content=https://dgls.dev/img/remote/ORf1m.jpg property=og:image><link href=https://dgls.dev/posts/3-amazing-react-hooks/ rel=canonical><meta content=no-referrer-when-downgrade name=referrer><link href=/feed/feed.xml rel=alternate title="dgls | blog" type=application/atom+xml><link href=/ rel=preconnect crossorigin=""><script src="/js/min.js?hash=17b5d2d281" async defer></script><script src="/js/cached.js?hash=4628d5e26f" async defer></script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary: #5DFDCB;--primary-dark: #02DE99}.hero,body{display:flex;flex-direction:column}body{min-height:100vh}body main{flex-grow:1}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px}share-widget div{width:30px;height:30px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center}.apple share-widget div{background-image:url(/img/share-apple.svg)}body,share-widget button{margin:0}share-widget button:active{transform:scale(1.2)}dialog{background-color:var(--primary-dark)}aside{font-style:italic}#nav{z-index:2;position:relative}#reading-progress{z-index:1;background-color:var(--primary);width:100vw;position:absolute;left:0;top:0;bottom:0;transform:translate(-100vw,0);will-change:transform;pointer-events:none}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:100;src:url(/fonts/Inter-Thin.woff2) format("woff2"),url(/fonts/Inter-Thin.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:100;src:url(/fonts/Inter-ThinItalic.woff2) format("woff2"),url(/fonts/Inter-ThinItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:200;src:url(/fonts/Inter-ExtraLight.woff2) format("woff2"),url(/fonts/Inter-ExtraLight.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:200;src:url(/fonts/Inter-ExtraLightItalic.woff2) format("woff2"),url(/fonts/Inter-ExtraLightItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:300;src:url(/fonts/Inter-Light.woff2) format("woff2"),url(/fonts/Inter-Light.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:300;src:url(/fonts/Inter-LightItalic.woff2) format("woff2"),url(/fonts/Inter-LightItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:400;src:url(/fonts/Inter-Regular.woff2) format("woff2"),url(/fonts/Inter-Regular.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:400;src:url(/fonts/Inter-Italic.woff2) format("woff2"),url(/fonts/Inter-Italic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:500;src:url(/fonts/Inter-Medium.woff2) format("woff2"),url(/fonts/Inter-Medium.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:500;src:url(/fonts/Inter-MediumItalic.woff2) format("woff2"),url(/fonts/Inter-MediumItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:600;src:url(/fonts/Inter-SemiBold.woff2) format("woff2"),url(/fonts/Inter-SemiBold.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:600;src:url(/fonts/Inter-SemiBoldItalic.woff2) format("woff2"),url(/fonts/Inter-SemiBoldItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:700;src:url(/fonts/Inter-Bold.woff2) format("woff2"),url(/fonts/Inter-Bold.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:700;src:url(/fonts/Inter-BoldItalic.woff2) format("woff2"),url(/fonts/Inter-BoldItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:800;src:url(/fonts/Inter-ExtraBold.woff2) format("woff2"),url(/fonts/Inter-ExtraBold.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:800;src:url(/fonts/Inter-ExtraBoldItalic.woff2) format("woff2"),url(/fonts/Inter-ExtraBoldItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:900;src:url(/fonts/Inter-Black.woff2) format("woff2"),url(/fonts/Inter-Black.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:900;src:url(/fonts/Inter-BlackItalic.woff2) format("woff2"),url(/fonts/Inter-BlackItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI var alt';font-weight:100 900;font-style:normal;font-named-instance:'Regular';src:url(/fonts/Inter-roman.var.woff2) format("woff2")}@font-face{font-display:swap;font-family:'Inter UI var alt';font-weight:100 900;font-style:italic;font-named-instance:'Italic';src:url(/fonts/Inter-italic.var.woff2) format("woff2")}.hero{min-height:600px;width:100%;background-position:top;background-size:cover;align-items:center;justify-content:center}html{scroll-padding-top:4rem;line-height:1.15;-webkit-text-size-adjust:100%}h1{line-height:3rem;font-size:3rem;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible;border-bottom:1px solid #444}pre{max-width:calc(100%-3rem)}a{background-color:transparent;text-decoration:none;color:#444}button,code,input{font-size:1rem}img{display:block;border-style:none;max-width:100%;height:auto;margin:0 auto}button,input{font-family:inherit;line-height:1.15;overflow:visible}button{text-transform:none}input{margin:0}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}h2{line-height:1.2;margin-bottom:.6em;line-height:2.4rem;margin-bottom:1.36rem;font-size:1.728rem}body,p,pre{font-size:1rem;line-height:1.6}p,pre{margin-bottom:1.5em}code,pre{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre code:not([class]){padding:1.5em;overflow-x:scroll}code{border-radius:.3em;color:#e2777a;padding:0 .3em;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%;background:#2d2d2d}h1,h2,html{font-family:Inter UI,sans-serif}a:hover,p a{text-decoration:underline}@media (min-width:600px){h1{font-size:4.3978rem;line-height:4.4rem;margin-bottom:1.496rem}body,p,pre{font-size:1.1rem;line-height:1.6}h2,p,pre{margin-bottom:1.496rem}}@media (min-width:1200px){body,p,pre{font-size:1.2rem;line-height:1.6}p,pre{margin-bottom:1.632rem}}@supports (font-variation-settings:normal){html{font-family:Inter UI var alt,sans-serif}}form{padding:1.5em 1.5em 0;border:.2rem solid #202020}button,input{border-radius:.3em;max-width:100%}form,input{margin-bottom:1.5em}input{padding:.75em;display:inline}form>:not(fieldset){margin-right:.75em}button{background:#f2f2f2;color:#191919;cursor:pointer;display:inline-block;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#fff;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}input[type=datetime],input[type=file],input[type=range],input[type=text],input[type=time],input[type=url],input[type=week]{border:1px solid #595959;padding:.75em}*{border:0;box-sizing:border-box}body,header nav a{font-family:Inter UI,sans-serif;color:#444}body,header nav{background:#fff}header{text-align:center;max-width:100%;display:flex;align-items:center;flex-direction:column}header p{margin-top:0}header nav{position:fixed;top:0;left:0;width:100vw;padding:1rem;font-weight:200;text-align:right}header nav h1{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav a{font-weight:700;text-decoration:none;margin-left:1.5em}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}footer{background:#e9e9e9;padding:2rem;text-align:center}footer>*{margin:1.5em}footer nav a img{vertical-align:middle}footer nav,footer p{font-size:90%}article{max-width:50rem;padding:1rem;margin:0 auto}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment{color:#999}.token.punctuation{color:#ccc}.token.boolean,.token.function{color:#f08d49}.token.constant,.token.property{color:#f8c555}.token.keyword{color:#cc99cd}.token.string{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.inserted{color:green}</style><header><nav><div id=nav><h1><a href=/ title=Homepage>dgls | blog</a></h1><a href=/about/ >About</a></div><div id=reading-progress aria-hidden=true></div></nav><div class=hero style="background-image: linear-gradient(rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.8)), url('/img/remote/hooks.jpg')"><h1>3 amazing REACT HOOKS to keep your code organized neatly</h1><time datetime=2020-11-25>25 Nov 2020</time><aside>6 min read.</aside></div><dialog id=message></dialog></header><main><article><p>Hi, my name is Doug. I’ve been a developer for several years and now work as the Lead Engineer at Shamaazi. Over this period of time, I have written a lot of different UIs and learned a lot of ways to structure React code.<p>This week I wanted to share my experience of the custom React Hooks I have found the most useful for producing websites in the cleanest, simplest way possible.<h2>React Hooks</h2><p>Hooks were first introduced to React in version 16.8, after being teased in 2018. There’s a fantastic guide introducing them on the <a href=https://reactjs.org/docs/hooks-intro.html>React website</a>. Simply stated, they are a way to write side-effects for functional UI components. This allows you to write parts of your UI as JavaScript functions, but still have the ability to manage state, call APIs, use storage, authenticate users, and so on.<p>React provides some hooks out of the box (<code>useState</code>, <code>useEffect</code> and <code>useContext</code> being the main three). On top of this, it allows you to compose your own higher-level hooks to separate out reusable logic. These custom hooks are what I’ll explore here. Here are the three I’ve found the most useful across the range of products we produce at Shamaazi.<h2>Performing Asynchronous Actions</h2><p>Most websites have to perform some form of asynchronous actions, whether it is loading data to display on the page or submitting data based on a user’s input and actions. It’s helpful to keep a track of the status of these asynchronous actions; is it currently loading? has it returned a result? Was there an error?<p>We found a lot of our components started sharing a lot of similar code, either for fetching data on an initial load or for submitting data. This looked like the following:<pre class=language-javascript><code class=language-javascript><span class="token keyword">const</span> <span class="token function function-variable">MyComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>loading<span class="token punctuation">,</span> setLoading<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>result<span class="token punctuation">,</span> setResult<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br><br>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token function">setResult</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br>    <span class="token function">setError</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br>    <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><br>    <span class="token keyword">try</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">doSomeAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token function">setResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">setError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span><br>      <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>loading<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">></span>loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">></span>something broke<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">{</span>result<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span><br><span class="token punctuation">}</span></code></pre><p>All this loading and error logic can be pulled into a hook, making our interface much neater.<pre class=language-javascript><code class=language-javascript><span class="token keyword">const</span> <span class="token function function-variable">MyTidyComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>loading<span class="token punctuation">,</span> result<span class="token punctuation">,</span> error<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useAsync</span><span class="token punctuation">(</span>doSomeAction<span class="token punctuation">)</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>loading<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">></span>loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">></span>something broke<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">{</span>result<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span><br><span class="token punctuation">}</span></code></pre><p>This <code>useAsync</code> hook is responsible for managing the loading, error and result states, removing the need for all this logic within the actual component. It also lets us reuse this throughout our application. This massively simplifies loading data onto a page.<p>As a bonus, we found we also wanted the ability to execute an action later, rather than just when the component is created. This is useful for performing asynchronous actions based on a user's input; actions like submitting a form can use the same hook but pass a <code>false</code> value as a second parameter. This indicates that they don’t want the action to be executed straight away.<pre class=language-javascript><code class=language-javascript><span class="token keyword">const</span> <span class="token punctuation">{</span> execute<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> result<span class="token punctuation">,</span> error <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useAsync</span><span class="token punctuation">(</span>submitSomeForm<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><br><br><span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>execute<span class="token punctuation">}</span><span class="token operator">></span><br>  <span class="token operator">...</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span></code></pre><p>We also found that the hook sometimes caused a memory leak if a form submission navigated away from the component (e.g. a form might take you to the next page when it is submitted, but setting <code>loading</code> to <code>false</code> after you’ve been taken away from the form is a memory leak). We’ve handled this by tracking whether the hook is mounted on the page (tracked through <code>useRef</code>). We’ll only update any state if the component is still present. This avoids any memory leaks.<p>The full version of our <code>useAsync</code> hook is here:<pre class=language-javascript><code class=language-javascript><span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">asyncFunction<span class="token punctuation">,</span> immediate <span class="token operator">=</span> <span class="token boolean">true</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>loading<span class="token punctuation">,</span> setLoading<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>result<span class="token punctuation">,</span> setResult<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br><br>  <span class="token comment">// Track a reference to whether the useAsync is actually on a mounted component.</span><br>  <span class="token comment">// useEffect below returns a cleanup that sets this to false. Before setting</span><br>  <span class="token comment">// any state, we check if the cleanup has run. If it has, don't update the state.</span><br>  <span class="token keyword">const</span> mounted <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><br><br>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      mounted<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token boolean">false</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">const</span> execute <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><br>    <span class="token function">setResult</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br>    <span class="token function">setError</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br>    <span class="token keyword">try</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">asyncFunction</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>mounted<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token function">setResult</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><br>      <span class="token punctuation">}</span><br>      <span class="token keyword">return</span> r<br>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>mounted<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token function">setError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>mounted<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>asyncFunction<span class="token punctuation">]</span><span class="token punctuation">)</span><br><br>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>immediate<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>execute<span class="token punctuation">,</span> immediate<span class="token punctuation">]</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span> execute<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> result<span class="token punctuation">,</span> error <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2>Updating LocalStorage or SessionStorage</h2><p>As part of some of our products, we populate a 'shopping basket'. This keeps a track of what a user has been doing. Sometimes, we want this to persist even if they navigate away from our site, refresh the page, or close the browser. To achieve this, we use a combination of <a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage>localStorage</a> and <a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage>sessionStorage</a><p>React itself doesn't provide any hooks for storing data in <code>localStorage</code> or <code>sessionStorage</code>, but we wanted a consistent experience with <code>useState</code>. Realistically, it shouldn't be any harder to use <code>localStorage</code> than it would be to use state normally.<p>For example, we might want to use <code>localStorage</code> to keep track of a user's input.<pre class=language-javascript><code class=language-javascript><span class="token keyword">const</span> <span class="token function function-variable">storageComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useLocalStorage</span><span class="token punctuation">(</span><span class="token string">'storage_key'</span><span class="token punctuation">,</span> <span class="token string">'default_value'</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token function">setValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span><br><span class="token punctuation">}</span></code></pre><p>Our hooks to achieve this look like the following:<pre class=language-javascript><code class=language-javascript><span class="token keyword">const</span> <span class="token function function-variable">useStorage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> initialValue<span class="token punctuation">,</span> storage</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// Pass initial state function to useState so logic is only executed once</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>storedValue<span class="token punctuation">,</span> setStoredValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">try</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> item <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><br>      <span class="token keyword">return</span> item <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">:</span> initialValue<br>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><br>      <span class="token keyword">return</span> initialValue<br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">try</span> <span class="token punctuation">{</span><br>      <span class="token comment">// Update storage every time the value is changed</span><br>      storage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>storedValue<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>storedValue<span class="token punctuation">,</span> storage<span class="token punctuation">,</span> key<span class="token punctuation">]</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">[</span>storedValue<span class="token punctuation">,</span> setStoredValue<span class="token punctuation">]</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function function-variable">useLocalStorage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> initialValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token function">useStorage</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> initialValue<span class="token punctuation">,</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function function-variable">useSessionStorage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> initialValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token function">useStorage</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> initialValue<span class="token punctuation">,</span> window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><h2>Authenticating users</h2><p>A super common scenario we've come across is having a bunch of components that all care whether a user is logged in. They often care about acting on the user too, through methods like <code>login</code>, <code>logout</code> or <code>resetPassword</code>.<p>In order to keep all these components in sync, we only want a single source of information about the current user. We could do this by having a component wrapping our entire application that manages a <code>user</code> state, and passes any props down to where they are used for the <code>user</code>, <code>login</code>, <code>logout</code> or <code>resetPassword</code> methods.<p>This quickly becomes messy though, with many components that don't really care being passed <code>user</code> <code>login</code> and <code>logout</code> props even if they don't use them themselves - only a child of theirs does.<p>Luckily React provides the idea of a <a href=https://reactjs.org/docs/hooks-reference.html#usecontext>context</a>. Allowing us to solve this problem.<p>We can create an Auth context, and use a hook to get any information from it we want. We can also embed our auth API calls into this context.<p>This would look like the following to use:<pre class=language-javascript><code class=language-javascript><span class="token comment">// In our top level App.js</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> ProvideAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'hooks/useAuth'</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>ProvideAuth<span class="token operator">></span><br>    <span class="token operator">&lt;</span>RestOfApplication<span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">...</span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>ProvideAuth<span class="token operator">></span><br><span class="token punctuation">}</span></code></pre><pre class=language-javascript><code class=language-javascript><span class="token comment">// in a component that wants to use Auth</span><br><span class="token keyword">import</span> useAuth <span class="token keyword">from</span> <span class="token string">'hooks/useAuth'</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> login<span class="token punctuation">,</span> logout<span class="token punctuation">,</span> resetPassword <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">></span><br>    <span class="token punctuation">{</span>user<span class="token punctuation">}</span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span><br><span class="token punctuation">}</span></code></pre><p>This hook itself looks like the following:<pre class=language-javascript><code class=language-javascript><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useCallback<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> createContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><br><br><span class="token keyword">const</span> authContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token comment">// Hook for child components to get the auth object and re-render when it changes.</span><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token function">useContext</span><span class="token punctuation">(</span>authContext<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Provider component that wraps components and makes useAuth() available</span><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">ProvideAuth</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> auth <span class="token operator">=</span> <span class="token function">useAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>authContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>auth<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>authContext<span class="token punctuation">.</span>Provider<span class="token operator">></span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Provide Auth hook that creates auth object and handles state</span><br><span class="token keyword">function</span> <span class="token function">useAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> setUser<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br><br>  <span class="token comment">// Get the logged in user when created</span><br>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">getLoggedInUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">const</span> <span class="token function function-variable">login</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token operator">...</span><br>    <span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">const</span> <span class="token function function-variable">logout</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token operator">...</span><br>    <span class="token function">setUser</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">const</span> <span class="token function function-variable">resetPassword</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token operator">...</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    resetPassword<br>    login<span class="token punctuation">,</span><br>    logout<span class="token punctuation">,</span><br>    user<br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>This has the additional benefit of keeping all of the authentication logic together. To change to a different auth provider, we would only have to change this one file.<h2>Conclusion</h2><p>React provides some really powerful abstractions for creating code that is neatly organised and easy to read. Here, we’ve looked at the three React Hooks I’ve found the most useful: <code>useAsync</code> for executing asynchronous actions either when a component is created or when a user performs an action, <code>useStorage</code> for using <code>localStorage</code> and <code>sessionStorage</code> in the same way as <code>useState</code>, and finally, <code>useAuth</code> for managing users and authentication.<p>These three hooks provide powerful abstractions that let you build React components in a simple manner.<hr><p>Do you have any other custom React Hooks you find useful? Think I’ve missed any key ones? Please let me know.<hr><p>Looking for other ways to keep your code organised? Check out my <a href=https://dgls.dev/posts/immutability/ >article on writing IMMUTABLE code</a>.<hr><p>Enjoyed this post? Want to share your thoughts on the matter? Found this article helpful? Disagree with me? Let me know by <a href=https://twitter.com/dglsparsons>messaging me on Twitter</a>.</p><script src=https://ko-fi.com/widgets/widget_2.js type=text/javascript></script><script type=text/javascript>kofiwidget2.init('Support Me on Ko-fi', '#444', 'R6R72KTY9');kofiwidget2.draw();</script><share-widget><button aria-label=Share href=https://dgls.dev/posts/3-amazing-react-hooks/ on-click=share><div></div></button></share-widget><script type=application/ld+json>{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "3 amazing REACT HOOKS to keep your code organized neatly",
  "image": [],
  "author": "Douglas Parsons",
  "genre": "technology and programming",
  "publisher": {
    "@type": "Organization",
    "name": "Douglas Parsons",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/favicon/favicon-192x192.png?hash=1eead310e9"
    }
  },
  "url": "https://dgls.dev/posts/3-amazing-react-hooks/",
  "mainEntityOfPage": "https://dgls.dev/posts/3-amazing-react-hooks/",
  "datePublished": "2020-11-25",
  "dateModified": "2021-08-10",
  "description": "Hi, my name is Doug. I’ve been a developer for several years and now work as the Lead Engineer at Shamaazi. Over this period of time, I have..."
}</script></article></main><footer><a href=/about/ >Douglas Parsons</a></footer>