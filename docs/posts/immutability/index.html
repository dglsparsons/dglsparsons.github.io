<!DOCTYPE html><html domain=dgls.dev ga-id=UA-177820617-1 lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href="/img/favicon/favicon.ico?hash=ba55cd0070" rel=icon><meta content=#f9c412 name=theme-color><title>How to write IMMUTABLE code and never get stuck debugging again</title><meta content="dgls | dev" property=og:site_name><meta content=https://dgls.dev property=og:url><meta content="How to write IMMUTABLE code and never get stuck debugging again" property=og:title><meta content=website property=og:type><meta content="How to write IMMUTABLE code and never get stuck debugging again" property=twitter:title><meta content="Lets look how walruses eating cheese can explain how immutability works, why you should care, and why the counterarguments against immutable code aren't worth considering." name=description><meta content="Lets look how walruses eating cheese can explain how immutability works, why you should care, and why the counterarguments against immutable code aren't worth considering." property=og:description><meta content="Lets look how walruses eating cheese can explain how immutability works, why you should care, and why the counterarguments against immutable code aren't worth considering." property=twitter:description><meta content=summary_large_image name=twitter:card><meta content=@dglsparsons name=twitter:site><meta content=@dglsparsons name=twitter:creator><meta content=https://dgls.dev/img/remote/walrus.jpg property=twitter:image><meta content=https://dgls.dev/img/remote/Z2iKwOl.jpg property=og:image><link href=https://dgls.dev/posts/immutability/ rel=canonical><meta content=no-referrer-when-downgrade name=referrer><link href=/feed/feed.xml rel=alternate title="dgls | blog" type=application/atom+xml><link href=/ rel=preconnect crossorigin=""><script src="/js/min.js?hash=17b5d2d281" async defer></script><script src="/js/cached.js?hash=4628d5e26f" async defer></script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary: #5DFDCB;--primary-dark: #02DE99}.hero,body{display:flex;flex-direction:column}body{min-height:100vh}body main{flex-grow:1}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px}share-widget div{width:30px;height:30px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center}.apple share-widget div{background-image:url(/img/share-apple.svg)}body,share-widget button{margin:0}share-widget button:active{transform:scale(1.2)}dialog{background-color:var(--primary-dark)}aside{font-style:italic}#nav{z-index:2;position:relative}#reading-progress{z-index:1;background-color:var(--primary);width:100vw;position:absolute;left:0;top:0;bottom:0;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:100;src:url(/fonts/Inter-Thin.woff2) format("woff2"),url(/fonts/Inter-Thin.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:100;src:url(/fonts/Inter-ThinItalic.woff2) format("woff2"),url(/fonts/Inter-ThinItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:200;src:url(/fonts/Inter-ExtraLight.woff2) format("woff2"),url(/fonts/Inter-ExtraLight.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:200;src:url(/fonts/Inter-ExtraLightItalic.woff2) format("woff2"),url(/fonts/Inter-ExtraLightItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:300;src:url(/fonts/Inter-Light.woff2) format("woff2"),url(/fonts/Inter-Light.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:300;src:url(/fonts/Inter-LightItalic.woff2) format("woff2"),url(/fonts/Inter-LightItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:400;src:url(/fonts/Inter-Regular.woff2) format("woff2"),url(/fonts/Inter-Regular.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:400;src:url(/fonts/Inter-Italic.woff2) format("woff2"),url(/fonts/Inter-Italic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:500;src:url(/fonts/Inter-Medium.woff2) format("woff2"),url(/fonts/Inter-Medium.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:500;src:url(/fonts/Inter-MediumItalic.woff2) format("woff2"),url(/fonts/Inter-MediumItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:600;src:url(/fonts/Inter-SemiBold.woff2) format("woff2"),url(/fonts/Inter-SemiBold.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:600;src:url(/fonts/Inter-SemiBoldItalic.woff2) format("woff2"),url(/fonts/Inter-SemiBoldItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:700;src:url(/fonts/Inter-Bold.woff2) format("woff2"),url(/fonts/Inter-Bold.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:700;src:url(/fonts/Inter-BoldItalic.woff2) format("woff2"),url(/fonts/Inter-BoldItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:800;src:url(/fonts/Inter-ExtraBold.woff2) format("woff2"),url(/fonts/Inter-ExtraBold.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:800;src:url(/fonts/Inter-ExtraBoldItalic.woff2) format("woff2"),url(/fonts/Inter-ExtraBoldItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:900;src:url(/fonts/Inter-Black.woff2) format("woff2"),url(/fonts/Inter-Black.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:900;src:url(/fonts/Inter-BlackItalic.woff2) format("woff2"),url(/fonts/Inter-BlackItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI var alt';font-weight:100 900;font-style:normal;font-named-instance:'Regular';src:url(/fonts/Inter-roman.var.woff2) format("woff2")}@font-face{font-display:swap;font-family:'Inter UI var alt';font-weight:100 900;font-style:italic;font-named-instance:'Italic';src:url(/fonts/Inter-italic.var.woff2) format("woff2")}.hero{min-height:600px;width:100%;background-position:top;background-size:cover;align-items:center;justify-content:center}html{scroll-padding-top:4rem;line-height:1.15;-webkit-text-size-adjust:100%}h1{line-height:3rem;font-size:3rem;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible;border-bottom:1px solid #444}a{background-color:transparent;text-decoration:none;color:#444}b,strong{font-weight:700}button,code{font-size:1rem}code{overflow-x:auto;border-radius:.3em;color:#e2777a;padding:0 .3em;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%;background:#2d2d2d}img{display:block;border-style:none;max-width:100%;height:auto;margin:0 auto}button{font-family:inherit;line-height:1.15;overflow:visible;text-transform:none}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}h2{line-height:1.2;margin-bottom:.6em;line-height:2.4rem;margin-bottom:1.36rem;font-size:1.728rem}body,p,ul{font-size:1rem;line-height:1.6}p,ul{margin-bottom:1.5em}h1,h2,html{font-family:Inter UI,sans-serif}a:hover,p a{text-decoration:underline}@media (min-width:600px){h1{font-size:4.3978rem;line-height:4.4rem;margin-bottom:1.496rem}body,p,ul{font-size:1.1rem;line-height:1.6}h2,p,ul{margin-bottom:1.496rem}}@media (min-width:1200px){body,p,ul{font-size:1.2rem;line-height:1.6}p,ul{margin-bottom:1.632rem}}@media (max-width:767px){x:-moz-any-link{display:table-cell}}@supports (font-variation-settings:normal){html{font-family:Inter UI var alt,sans-serif}}button{border-radius:.3em;max-width:100%;background:#f2f2f2;color:#191919;cursor:pointer;display:inline-block;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#fff;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}*{border:0;box-sizing:border-box}body,header nav a{font-family:Inter UI,sans-serif;color:#444}body,header nav{background:#fff}header{text-align:center;max-width:100%;display:flex;align-items:center;flex-direction:column}header p,ul{margin-top:0}header nav{position:fixed;top:0;left:0;width:100vw;padding:1rem;font-weight:200;text-align:right}header nav h1{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav a{font-weight:700;text-decoration:none;margin-left:1.5em}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}footer{background:#e9e9e9;padding:2rem;text-align:center}figure,footer>*{margin:1.5em}footer nav a img{vertical-align:middle}footer nav,footer p{font-size:90%}article{max-width:50rem;padding:1rem;margin:0 auto}li ul{margin-bottom:0}blockquote{border-left:1px solid #f9c412;padding:0 1.5em;margin:1.5em 0 1.5em 1.5em}blockquote footer{background:0 0;display:block;color:#ccc;padding:.75em 0;font-size:90%;text-align:start}figure img{display:block}</style><header><nav><div id=nav><h1><a href=/ title=Homepage>dgls | blog</a></h1><a href=/about/ >About</a></div><div id=reading-progress aria-hidden=true></div></nav><div class=hero style="background-image: linear-gradient(rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.8)), url('/img/remote/walrus.jpg')"><h1>How to write IMMUTABLE code and never get stuck debugging again</h1><time datetime=2020-11-17>17 Nov 2020</time><aside>4 min read.</aside></div><dialog id=message></dialog></header><main><article><p>I've written production code in a variety of different languages throughout my career, including Haskell, Scala, Go, Python, Java or JavaScript. While each language has its own clear benefits, working as a polyglot across a range of different paradigms has changed the way I write code. Certain skills and concepts are transferable regardless of the language being written. I believe immutability is one of these key concepts. By writing immutable code it is possible to make programs easier to reason about, easier to write and easier to debug.<p>Here, we’ll look at three things:<ul><li>how walruses eating cheese can explain how immutability works,<li>why you should care, and<li>why the counterarguments against immutable code aren’t worth considering.</ul><h2>What is immutability?</h2><blockquote><p>“unchanging over time or unable to be changed.” - Oxford Languages definition.</blockquote><p>Immutability is the idea that once an object or variable has been created, its value should never change or be updated by anything. For objects or classes, this also includes any fields; literally, nothing should change! The object is effectively read-only.<p>Writing code in this style requires a mindset shift at times though. The first time I came across the idea, it made absolutely no sense to me and seemed insane. I was confused and wanted to immediately unpick it all, writing it in a way I was familiar with. Gary Bernhardt, in his <a href=https://www.destroyallsoftware.com/talks/boundaries>talk on boundaries</a>, gives a fantastic example of why it feels so wrong.<p>He talks about feeding walruses cheese.<p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/remote/walrus-1920w.webp 1920w, /img/remote/walrus-1280w.webp 1280w, /img/remote/walrus-640w.webp 640w, /img/remote/walrus-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/remote/walrus-1920w.jpg 1920w, /img/remote/walrus-1280w.jpg 1280w, /img/remote/walrus-640w.jpg 640w, /img/remote/walrus-320w.jpg 320w" type=image/jpeg><img alt=Walrus decoding=async height=914 loading=lazy src=/img/remote/walrus.jpg style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 1280px) min(calc(var(--main-width) * 0.7140625), 914px);background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1280 914'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAHCAIAAABV+fA3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAz0lEQVQI1wHEADv/ANrn8+Ds+OTw/eXv/OLs99zm8Nnj7dPa48HI0wDV3+Xd5Ofg5OXi7ffi7ffd6fXV2t/Evru+xM4Ay7KQyLGSwKiKz7+o0MO32tHBmINvakYtqJiLAI96YauSb5+BW6eDUrKHUqaBTmNBIWE4IIllRwBFMRthSi9lQBl0ShuAWStiPBo0FgUzFwZbQSoAoZWAnpKCpJSDindmopWIsKGVl4qBcmZffHFoAKminM3IwtjUz9nW0uTf29fSz9HLxtPMx7uzrJPldgzhlLlgAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)" width=1280></picture><p>In a mutable version, we might instruct each walrus to eat some cheese. This cheese then gets added to the contents of their stomach. Makes a lot of sense, right?<p>In an immutable version, we have to perform a mind-bending operation. To feed the walruses we would have to:<ul><li>create a brand new stomach that’s the same as the old stomach, but with some cheese in it.<li>Then, create a new walrus that’s the same as the old walrus, except, with the stomach replaced.<li>Then, throw away all the old walrus.</ul><p>At first glance, this sounds bonkers but stay with me - let’s look at what makes writing code like this worthwhile.<h2>How does it prevent pain when debugging?</h2><p>Have you ever encountered:<ul><li><code>undefined is not a function</code> in JavaScript?<li><code>NullPointerException</code>s in Java?<li><code>SegFault</code> in C/C++?<li><code>panic</code> in Go?<li><code>NoneType has no attribute foo</code> in Python?</ul><p>If you’ve worked in any of these languages, then chances are you probably have. The thing is, all of these errors are caused by the same thing: <strong>missing, or null, data.</strong><p>Missing data and null values are definitely among the most difficult types of bugs to track down and fix. I’ve spent countless hours in the past sifting through JavaScript code trying to figure out why the value I thought should be there, wasn’t. Why my application suddenly crashed when everything seemed to be going fine. Sir Tony Hoare even describes null as <a href=https://qconlondon.com/london-2009/qconlondon.com/london-2009/speaker/Tony+Hoare.html>“The Billion Dollar Mistake”</a> because of the countless bugs, security vulnerabilities and crashes that have resulted from it.<p><strong>Let’s just agree: nulls can be evil.</strong><p>The reason these bugs are so hard to hunt down and to fix is that the effect (the exception) is far away from the cause (the introduction of null). Actually throwing a null pointer error happens some arbitrary amount of time after we introduce a null, and we get <code>undefined</code> errors accessing a property miles away from where we thought the property was set. Debugging becomes a case of reading carefully back through code until we find the cause.<p>The more state changes that happen in code, the more places these bugs can be introduced. Instead, we can attempt to reduce the surface area of any code. The fewer mutations in a codebase, the less surface area there is for bugs. This leads to fewer bugs.<p>If you only ever set a value once, there’s only one place that value can be faulty. If you make changes to an object as it gets passed around, any one of those places could introduce potential issues. If one of our walruses is faulty, we know it can only have happened when we made the latest walrus, complete with the new stomach. It can’t be an issue with an earlier walrus - they are long gone.<p>So really, immutability, or, never changing a value, really saves us from getting stuck debugging.<h2>Why performance isn’t a concern</h2><p>Some eagle-eyed people might be thinking “those walruses earlier… isn’t throwing them all in the bin and making new ones pretty expensive? Won’t it make my code slow?”.<p>The answer isn’t simple.<p>You’re right in saying that throwing away walruses all the time isn’t totally necessary, and it can make things the tiniest amount slower sometimes. The keyword being sometimes here though. Sometimes compilers are clever enough to optimise this behaviour with something more efficient. Some languages even <a href=https://doc.rust-lang.org/book/ch03-01-variables-and-mutability.html>prefer immutability by default</a>. Immutability also has great benefits when it comes to multi-threading or parallelisation, as it allows lock-free sharing, knowing that values <a href=https://softwareengineering.stackexchange.com/questions/171253/does-immutability-entirely-eliminate-the-need-for-locks-in-multi-processor-progr>won’t be changed</a>.<p>Despite all this, even if creating new walruses is slower in the language you use, the cost of allocating a new object is almost certainly minuscule compared to anything else within an application. Unless you are benchmarking and actively measuring performance, then you almost certainly shouldn’t care.<h2>Conclusion</h2><p>Immutability is a powerful tool when programming. It allows us to write code that is easier to debug and reason about. It requires a bit of a mindset shift, but in my experience, it’s definitely worth making the mental leap.<p>Give it a go, and let me know what you think :).<hr><p>Looking for other ways to improve the clarity of your code? Why not check out my <a href=https://dgls.dev/posts/else-statement/ >post on never using else statements</a>.<hr><p>Enjoyed this post? Want to share your thoughts on the matter? Found this article helpful? Disagree with me? Let me know by <a href=twitter.com/dglsparsons>messaging me on Twitter</a>.</p><script src=https://ko-fi.com/widgets/widget_2.js type=text/javascript></script><script type=text/javascript>kofiwidget2.init('Support Me on Ko-fi', '#444', 'R6R72KTY9');kofiwidget2.draw();</script><share-widget><button aria-label=Share href=https://dgls.dev/posts/immutability/ on-click=share><div></div></button></share-widget><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","headline":"How to write IMMUTABLE code and never get stuck debugging again","image":["https://dgls.dev/img/remote/walrus.jpg"],"author":"Douglas Parsons","genre":"technology and programming","publisher":{"@type":"Organization","name":"Douglas Parsons","logo":{"@type":"ImageObject","url":"/img/favicon/favicon-192x192.png?hash=1eead310e9"}},"url":"https://dgls.dev/posts/immutability/","mainEntityOfPage":"https://dgls.dev/posts/immutability/","datePublished":"2020-11-17","dateModified":"2021-08-10","description":"I&#39;ve written production code in a variety of different languages throughout my career, including Haskell, Scala, Go, Python, Java or..."}</script></article></main><footer><a href=/about/ >Douglas Parsons</a></footer>