<!DOCTYPE html><html domain=dgls.dev ga-id=UA-177820617-1 lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href="/img/favicon/favicon.ico?hash=ba55cd0070" rel=icon><meta content=#f9c412 name=theme-color><title>Task - An easy to use tool to simplify your build</title><meta content="dgls | dev" property=og:site_name><meta content=https://dgls.dev property=og:url><meta content="Task - An easy to use tool to simplify your build" property=og:title><meta content=website property=og:type><meta content="Task - An easy to use tool to simplify your build" property=twitter:title><meta content="At Shamaazi we've been using a tool called task. It's incredibly powerful and incredibly useful for organising and performing repeated jobs. Let's explore what it's capable of." name=description><meta content="At Shamaazi we've been using a tool called task. It's incredibly powerful and incredibly useful for organising and performing repeated jobs. Let's explore what it's capable of." property=og:description><meta content="At Shamaazi we've been using a tool called task. It's incredibly powerful and incredibly useful for organising and performing repeated jobs. Let's explore what it's capable of." property=twitter:description><meta content=summary_large_image name=twitter:card><meta content=@dglsparsons name=twitter:site><meta content=@dglsparsons name=twitter:creator><meta content=https://dgls.dev/img/remote/thinking.webp property=twitter:image><meta content=https://dgls.dev/img/remote/Z2ep5Ym.webp property=og:image><link href=https://dgls.dev/posts/task-a-simple-automation-tool/ rel=canonical><meta content=no-referrer-when-downgrade name=referrer><link href=/feed/feed.xml rel=alternate title="dgls | blog" type=application/atom+xml><link href=/ rel=preconnect crossorigin=""><script src="/js/min.js?hash=17b5d2d281" async defer></script><script src="/js/cached.js?hash=4628d5e26f" async defer></script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary: #5DFDCB;--primary-dark: #02DE99}.hero,body{display:flex;flex-direction:column}body{min-height:100vh}body main{flex-grow:1}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px}share-widget div{width:30px;height:30px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center}.apple share-widget div{background-image:url(/img/share-apple.svg)}body,share-widget button{margin:0}share-widget button:active{transform:scale(1.2)}dialog{background-color:var(--primary-dark)}aside{font-style:italic}#nav{z-index:2;position:relative}#reading-progress{z-index:1;background-color:var(--primary);width:100vw;position:absolute;left:0;top:0;bottom:0;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:100;src:url(/fonts/Inter-Thin.woff2) format("woff2"),url(/fonts/Inter-Thin.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:100;src:url(/fonts/Inter-ThinItalic.woff2) format("woff2"),url(/fonts/Inter-ThinItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:200;src:url(/fonts/Inter-ExtraLight.woff2) format("woff2"),url(/fonts/Inter-ExtraLight.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:200;src:url(/fonts/Inter-ExtraLightItalic.woff2) format("woff2"),url(/fonts/Inter-ExtraLightItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:300;src:url(/fonts/Inter-Light.woff2) format("woff2"),url(/fonts/Inter-Light.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:300;src:url(/fonts/Inter-LightItalic.woff2) format("woff2"),url(/fonts/Inter-LightItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:400;src:url(/fonts/Inter-Regular.woff2) format("woff2"),url(/fonts/Inter-Regular.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:400;src:url(/fonts/Inter-Italic.woff2) format("woff2"),url(/fonts/Inter-Italic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:500;src:url(/fonts/Inter-Medium.woff2) format("woff2"),url(/fonts/Inter-Medium.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:500;src:url(/fonts/Inter-MediumItalic.woff2) format("woff2"),url(/fonts/Inter-MediumItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:600;src:url(/fonts/Inter-SemiBold.woff2) format("woff2"),url(/fonts/Inter-SemiBold.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:600;src:url(/fonts/Inter-SemiBoldItalic.woff2) format("woff2"),url(/fonts/Inter-SemiBoldItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:700;src:url(/fonts/Inter-Bold.woff2) format("woff2"),url(/fonts/Inter-Bold.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:700;src:url(/fonts/Inter-BoldItalic.woff2) format("woff2"),url(/fonts/Inter-BoldItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:800;src:url(/fonts/Inter-ExtraBold.woff2) format("woff2"),url(/fonts/Inter-ExtraBold.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:800;src:url(/fonts/Inter-ExtraBoldItalic.woff2) format("woff2"),url(/fonts/Inter-ExtraBoldItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:900;src:url(/fonts/Inter-Black.woff2) format("woff2"),url(/fonts/Inter-Black.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:900;src:url(/fonts/Inter-BlackItalic.woff2) format("woff2"),url(/fonts/Inter-BlackItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI var alt';font-weight:100 900;font-style:normal;font-named-instance:'Regular';src:url(/fonts/Inter-roman.var.woff2) format("woff2")}@font-face{font-display:swap;font-family:'Inter UI var alt';font-weight:100 900;font-style:italic;font-named-instance:'Italic';src:url(/fonts/Inter-italic.var.woff2) format("woff2")}.hero{min-height:600px;width:100%;background-position:top;background-size:cover;align-items:center;justify-content:center}html{scroll-padding-top:4rem;line-height:1.15;-webkit-text-size-adjust:100%}h1{line-height:3rem;font-size:3rem;margin:.67em 0}pre{max-width:calc(100%-3rem)}a{background-color:transparent;text-decoration:none;color:#444}button,code,input{font-size:1rem}small{font-size:80%;color:#ccc}img{display:block;border-style:none;max-width:100%;height:auto;margin:0 auto}button,input{font-family:inherit;line-height:1.15;overflow:visible}button{text-transform:none}input{margin:0}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}summary{display:list-item}h2{line-height:1.2;margin-bottom:.6em;line-height:2.4rem;margin-bottom:1.36rem;font-size:1.728rem}body,p,pre,ul{font-size:1rem;line-height:1.6}p,pre,ul{margin-bottom:1.5em}code,pre{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre code:not([class]){padding:1.5em;overflow-x:scroll}code{border-radius:.3em;color:#e2777a;padding:0 .3em;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%;background:#2d2d2d}h1,h2,html{font-family:Inter UI,sans-serif}a:hover,p a{text-decoration:underline}@media (min-width:600px){h1{font-size:4.3978rem;line-height:4.4rem;margin-bottom:1.496rem}body,p,pre,ul{font-size:1.1rem;line-height:1.6}h2,p,pre,ul{margin-bottom:1.496rem}}@media (min-width:1200px){body,p,pre,ul{font-size:1.2rem;line-height:1.6}p,pre,ul{margin-bottom:1.632rem}}@supports (font-variation-settings:normal){html{font-family:Inter UI var alt,sans-serif}}button,input{border-radius:.3em;max-width:100%}button{background:#f2f2f2;color:#191919;cursor:pointer;display:inline-block;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}input{padding:.75em;margin-bottom:1.5em;display:inline}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#fff;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}input[type=date],input[type=datetime],input[type=file],input[type=number],input[type=text],input[type=time],input[type=url]{border:1px solid #595959;padding:.75em}*{border:0;box-sizing:border-box}body,header nav a{font-family:Inter UI,sans-serif;color:#444}body,header nav{background:#fff}section{margin-left:auto;margin-right:auto;width:900px}header{text-align:center;max-width:100%;display:flex;align-items:center;flex-direction:column}header p,ul{margin-top:0}header nav{position:fixed;top:0;left:0;width:100vw;padding:1rem;font-weight:200;text-align:right}header nav h1{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav a{font-weight:700;text-decoration:none;margin-left:1.5em}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}footer{background:#e9e9e9;padding:2rem;text-align:center}footer>*{margin:1.5em}footer nav a img{vertical-align:middle}footer nav,footer p{font-size:90%}article{max-width:50rem;padding:1rem;margin:0 auto}li ul{margin-bottom:0}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment{color:#999}.token.punctuation{color:#ccc}.token.tag{color:#e2777a}.token.boolean,.token.function,.token.number{color:#f08d49}.token.property{color:#f8c555}.token.atrule,.token.important{color:#cc99cd}.token.string,.token.variable{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.important{font-weight:700}.token.inserted{color:green}</style><header><nav><div id=nav><h1><a href=/ title=Homepage>dgls | blog</a></h1><a href=/about/ >About</a></div><div id=reading-progress aria-hidden=true></div></nav><div class=hero style="background-image: linear-gradient(rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.8)), url('/img/remote/thinking.webp')"><h1>Task - An easy to use tool to simplify your build</h1><time datetime=2020-09-25>25 Sep 2020</time><aside>7 min read.</aside></div><dialog id=message></dialog></header><main><article><p>At Shamaazi we've been using a tool called <a href=https://taskfile.dev><code>task</code></a>. It's an incredibly powerful tool that can completely replace Makefiles (an old C build system), or complicated scripts, with a much simpler and arguably more powerful alternative. Outside of that, it's an incredibly useful organiser for all command-line related activities.<p>At Shamaazi we have a monolithic codebase, containing 7 different UIs, hundreds of services and all our infrastructure provisioning. We use <code>task</code> to manage all of this, as well as performing housekeeping jobs such as deleting user data when requested or changing peoples contact addresses. We find it incredibly powerful for this as it's easy to read config, self-documenting nature, and ability to only run commands that need running all save us tonnes of time waiting for builds, searching for commands, or editing config. It's equally valuable on small codebases too.<p>Let's have a quick explore of what <code>task</code> is, and what it's capable of.<h2>Getting Started</h2><p>The simplest way to install <code>task</code> is through an install script they provide.<pre class=language-bash><code class=language-bash><span class="token function">curl</span> -sL https://taskfile.dev/install.sh <span class="token operator">|</span> <span class="token function">sh</span></code></pre><p>However, there are a tonne of other methods to install it, such as through <code>brew</code>, <code>snap</code> or <code>scoop</code>. You can find them all <a href=https://taskfile.dev/#/installation>here</a>.<p>Once installed we can run <code>task --init</code> in a directory we want to issue commands from. This will create a simple <code>Taskfile.yml</code> file. This file is in YAML format - an incredibly popular human-readable file format. This <code>Taskfile.yml</code> file is used to define all the possible tasks we want to run. Initially, it just contains a <code>Hello, World!</code> example.<pre class=language-yaml><code class=language-yaml><span class="token comment"># https://taskfile.dev</span><br><br><span class="token atrule key">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span><br><br><span class="token atrule key">vars</span><span class="token punctuation">:</span><br>  <span class="token atrule key">GREETING</span><span class="token punctuation">:</span> Hello<span class="token punctuation">,</span> World<span class="token tag">!</span><br><br><span class="token atrule key">tasks</span><span class="token punctuation">:</span><br>  <span class="token atrule key">default</span><span class="token punctuation">:</span><br>    <span class="token atrule key">cmds</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> echo "<span class="token punctuation">{</span><span class="token punctuation">{</span>.GREETING<span class="token punctuation">}</span><span class="token punctuation">}</span>"<br>    <span class="token atrule key">silent</span><span class="token punctuation">:</span> <span class="token important boolean">true</span></code></pre><p>Running <code>task</code> (or <code>task default</code>) will run the <code>default</code> task defined above, printing <code>Hello, World!</code>. We can break down the file into some clear sections:<ul><li><code>version: '3'</code> - this defines the version of Taskfile to use. We don't need to pay too much attention, but this prevents and future releases from stopping your tasks from working.<li><code>vars:</code> - this section defines any globally accessible variables we want to use. We can see a single variable, <code>GREETING</code> defined as the <code>Hello, World!</code>. These variables are really powerful, and can reference other variables, or can be derived entirely from the output of a command.<li><code>tasks:</code> - this section is where the actual tasks are defined. At the moment we just have a single task called <code>default</code>. When this task is run, it will run the command <code>echo "{{.GREETING}}"</code>. The <code>silent: true</code> line simply prevents <code>task</code> from printing out the command that is being run.</ul><p>This serves a super quick introduction. But let's cover some of the more powerful features.<h2>Variables</h2><p>In the previous section, I mention that the GREETING variable could be derived from the output of a command. This is sometimes incredibly useful for deriving information that isn't immediately available. For a quick example of this, let's change the <code>vars</code> section to the following:<pre class=language-yaml><code class=language-yaml><span class="token atrule key">vars</span><span class="token punctuation">:</span><br>  <span class="token atrule key">GREETING</span><span class="token punctuation">:</span><br>    <span class="token atrule key">sh</span><span class="token punctuation">:</span> echo "Hello<span class="token punctuation">,</span> $(whoami)<span class="token tag">!</span>"</code></pre><p>Running <code>task</code> now will output <code>Hello, dglsparsons!</code> (or whatever your username happens to be!). As it's executing a command, this could literally be anything. Let's use <code>wttr.in</code> to provide the weather (and using <a href=https://stedolan.github.io/jq/ >jq</a> to quickly make something of the output. We can then add this to a second task.<pre class=language-yaml><code class=language-yaml><span class="token atrule key">vars</span><span class="token punctuation">:</span><br>  <span class="token atrule key">GREETING</span><span class="token punctuation">:</span><br>    <span class="token atrule key">sh</span><span class="token punctuation">:</span> echo "Hello<span class="token punctuation">,</span> $(whoami)<span class="token tag">!</span>"<br>  <span class="token atrule key">WEATHER</span><span class="token punctuation">:</span><br>    <span class="token atrule key">sh</span><span class="token punctuation">:</span> curl <span class="token punctuation">-</span>s wttr.in<span class="token punctuation">?</span>format=j1 <span class="token punctuation">|</span> jq <span class="token punctuation">-</span>r .current_condition<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.weatherDesc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.value<br><br><span class="token atrule key">tasks</span><span class="token punctuation">:</span><br>  <span class="token atrule key">default</span><span class="token punctuation">:</span><br>    <span class="token atrule key">cmds</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> echo "<span class="token punctuation">{</span><span class="token punctuation">{</span>.GREETING<span class="token punctuation">}</span><span class="token punctuation">}</span>"<br>    <span class="token atrule key">silent</span><span class="token punctuation">:</span> <span class="token important boolean">true</span><br>  <span class="token atrule key">weather</span><span class="token punctuation">:</span><br>    <span class="token atrule key">cmds</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> echo "There be <span class="token punctuation">{</span><span class="token punctuation">{</span>.WEATHER<span class="token punctuation">}</span><span class="token punctuation">}</span>"<br>    <span class="token atrule key">silent</span><span class="token punctuation">:</span> <span class="token important boolean">true</span></code></pre><p>Running <code>task</code> now will still print out the same greeting. However, running <code>task weather</code> will print out something along the lines of:<pre><code>There be Haze.
</code></pre><p>That was quick and easy. And now we've got that command saved for good, in a nice memorable location.<h2>Documentation</h2><p>So our tasks are useful, but they would be a lot more useful if they explained what they did. Let's add some short descriptions to them. This can be done through the <code>desc</code> key on each task.<pre class=language-yaml><code class=language-yaml><span class="token atrule key">tasks</span><span class="token punctuation">:</span><br>  <span class="token atrule key">default</span><span class="token punctuation">:</span><br>    <span class="token atrule key">desc</span><span class="token punctuation">:</span> Prints a greeting.<br>    <span class="token atrule key">cmds</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> echo "<span class="token punctuation">{</span><span class="token punctuation">{</span>.GREETING<span class="token punctuation">}</span><span class="token punctuation">}</span>"<br>    <span class="token atrule key">silent</span><span class="token punctuation">:</span> <span class="token important boolean">true</span><br>  <span class="token atrule key">weather</span><span class="token punctuation">:</span><br>    <span class="token atrule key">desc</span><span class="token punctuation">:</span> Prints out the current weather.<br>    <span class="token atrule key">cmds</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> echo "There be <span class="token punctuation">{</span><span class="token punctuation">{</span>.WEATHER<span class="token punctuation">}</span><span class="token punctuation">}</span>"<br>    <span class="token atrule key">silent</span><span class="token punctuation">:</span> <span class="token important boolean">true</span></code></pre><p>We can now run <code>task -l</code> or <code>task --list</code> to show a handy summary of all the available tasks.<pre class=language-yaml><code class=language-yaml>$ task <span class="token punctuation">-</span><span class="token punctuation">-</span>list<br><span class="token atrule key">task</span><span class="token punctuation">:</span> <span class="token atrule key">Available tasks for this project</span><span class="token punctuation">:</span><br>* default<span class="token punctuation">:</span> 	Prints a greeting.<br>* weather<span class="token punctuation">:</span> 	Prints out the current weather.</code></pre><p>This makes the tasks much easier to remember in the future!<h2>Dependencies</h2><p>Rather than going and downloading a weather forecast every single we want to check, let's create a task to write the weather forecast into a file.<pre class=language-yaml><code class=language-yaml><span class="token atrule key">vars</span><span class="token punctuation">:</span><br>  <span class="token atrule key">GREETING</span><span class="token punctuation">:</span><br>    <span class="token atrule key">sh</span><span class="token punctuation">:</span> echo "Hello<span class="token punctuation">,</span> $(whoami)<span class="token tag">!</span>"<br>  <span class="token atrule key">WEATHER_FILE</span><span class="token punctuation">:</span> weather.json<br><br><span class="token atrule key">tasks</span><span class="token punctuation">:</span><br>  <span class="token atrule key">default</span><span class="token punctuation">:</span><br>    <span class="token atrule key">desc</span><span class="token punctuation">:</span> Prints a greeting.<br>    <span class="token atrule key">cmds</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> echo "<span class="token punctuation">{</span><span class="token punctuation">{</span>.GREETING<span class="token punctuation">}</span><span class="token punctuation">}</span>"<br>    <span class="token atrule key">silent</span><span class="token punctuation">:</span> <span class="token important boolean">true</span><br>  <span class="token atrule key">download-weather</span><span class="token punctuation">:</span><br>    <span class="token atrule key">desc</span><span class="token punctuation">:</span> Downloads a weather forecast into a file<br>    <span class="token atrule key">cmds</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> curl <span class="token punctuation">-</span>s wttr.in<span class="token punctuation">?</span>format=j1 <span class="token punctuation">></span> <span class="token punctuation">{</span><span class="token punctuation">{</span>.WEATHER_FILE<span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>This is a good start, but running <code>download-weather</code> will always download the forecast. If we were using some file as an input, you could set this as a <code>source</code>, even with a wildcard. This is incredibly useful for building code only when required. e.g.<pre class=language-yaml><code class=language-yaml><span class="token atrule key">tasks</span><span class="token punctuation">:</span><br>  <span class="token atrule key">build</span><span class="token punctuation">:</span><br>    <span class="token atrule key">cmds</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> go build .<br>    <span class="token atrule key">sources</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> ./<span class="token important">*.go</span></code></pre><p>This will only run <code>go build</code> if any <code>.go</code> files have been updated. For our purposes though, we don't have input files. Instead, we can use the <code>status</code> field to check programatically.<pre class=language-yaml><code class=language-yaml>  <span class="token atrule key">download-weather</span><span class="token punctuation">:</span><br>    <span class="token atrule key">desc</span><span class="token punctuation">:</span> Downloads a weather forecast into a file<br>    <span class="token atrule key">cmds</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> curl <span class="token punctuation">-</span>s wttr.in<span class="token punctuation">?</span>format=j1 <span class="token punctuation">></span> <span class="token punctuation">{</span><span class="token punctuation">{</span>.WEATHER_FILE<span class="token punctuation">}</span><span class="token punctuation">}</span><br>    <span class="token atrule key">status</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> test <span class="token punctuation">-</span>f ./<span class="token punctuation">{</span><span class="token punctuation">{</span>.WEATHER_FILE<span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>Running <code>task download-weather</code> multiple times will result in the file being downloaded the first time, but not subsequently. Instead, a message is produced: <code>task: Task "download-weather" is up to date</code>.<p>Let's go one step further and make our previous <code>weather</code> task depend on the weather file being downloaded. This can be done easily through a <code>deps</code> field. This means running the <code>weather</code> command would attempt to run <code>download-weather</code>. download-weather, in turn, will download the weather into a file, but, only if the file isn't already present... This sounds a mouthful, but bear with me and you'll hopefully see the value in this!<pre class=language-yaml><code class=language-yaml>  <span class="token atrule key">weather</span><span class="token punctuation">:</span><br>    <span class="token atrule key">desc</span><span class="token punctuation">:</span> Prints out the current weather.<br>    <span class="token atrule key">deps</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> download<span class="token punctuation">-</span>weather<br>    <span class="token atrule key">cmds</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> echo "There be $(cat <span class="token punctuation">{</span><span class="token punctuation">{</span>.WEATHER_FILE<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">|</span> jq <span class="token punctuation">-</span>r .current_condition<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.weatherDesc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.value)"<br>    <span class="token atrule key">silent</span><span class="token punctuation">:</span> <span class="token important boolean">true</span></code></pre><p>Running <code>task weather</code> will produce the following output if there is weather to download:<pre class=language-bash><code class=language-bash>task: <span class="token function">curl</span> -s wttr.in?format<span class="token operator">=</span>j1 <span class="token operator">></span> weather.json<br>There be Haze</code></pre><p>However, running it again will not download anything, and just print the value of the weather out:<pre class=language-bash><code class=language-bash>task: Task <span class="token string">"download-weather"</span> is up to <span class="token function">date</span><br>There be Haze</code></pre><p>We can now hopefully see the value in this! We only do work if we have to, and each task can easily check if it has work to do. This can be incredibly useful for software development. For example, we could create a <code>deploy</code> task that depends on a <code>build</code> task. The <code>build</code> task will only build if the code has been updated since the last <code>build</code>. We can even make the <code>deploy</code> only perform an actual deployment if the built files are newer than the last deployment.<h2>A Real World Example</h2><p>So far we've looked at a rather contrived example using <code>curl</code> to download a weather forecast. Instead, let's look at a common code example of building a javascript project. We can define the desired behaviour as follows:<ul><li>running <code>task build</code> should run <code>npm run build</code>.<li><code>npm run build</code> should only be run if there are any new changes to our source files since the last build.<li><code>npm run build</code> should only be run if the latest <code>node_modules</code> are installed.<li>the latest <code>node_modules</code> should be installed only if there have been changes to our packages since the last install.</ul><p>These three conditions can be checked using the magical <code>test</code> and <code>find</code> tools. <code>test</code> can be used to check if an output of a command returns some content (using <code>test -z</code>). It is also capable of checking whether files exist using <code>test -f</code>, and whether directories exist using <code>test -d</code>. If a file/directory doesn't exist, or a command returned some output, then the process will exit with a status code, indicating the command failed. Finally, <code>find</code> can be used along with the <code>-newer</code> flag to find files that are newer than our output.<p>Our Taskfile.yml could look like the following:<pre class=language-yaml><code class=language-yaml><span class="token comment"># https://taskfile.dev</span><br><span class="token atrule key">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span><br><span class="token atrule key">output</span><span class="token punctuation">:</span> prefixed<br><span class="token atrule key">tasks</span><span class="token punctuation">:</span><br>  <span class="token atrule key">build</span><span class="token punctuation">:</span><br>    <span class="token atrule key">desc</span><span class="token punctuation">:</span> Build all static artifacts into build<br>    <span class="token atrule key">deps</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> node_modules <span class="token punctuation">]</span><br>    <span class="token atrule key">cmds</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> npm run build<br>    <span class="token atrule key">status</span><span class="token punctuation">:</span><br>      <span class="token comment"># Lets check that our output directory exists</span><br>      <span class="token punctuation">-</span> test <span class="token punctuation">-</span>d build<br>      <span class="token comment"># And that our index.html file exists</span><br>      <span class="token punctuation">-</span> test <span class="token punctuation">-</span>f build/index.html<br>      <span class="token comment"># Finally, check if there are any files in `src`, `public` or `node_modules` that are newer than</span><br>      <span class="token comment"># out build/index.html output.</span><br>      <span class="token punctuation">-</span> test <span class="token punctuation">-</span>z "$(find src public node_modules <span class="token punctuation">-</span>type f <span class="token punctuation">-</span>newer build/index.html)"<br>  <span class="token atrule key">node_modules</span><span class="token punctuation">:</span><br>    <span class="token atrule key">desc</span><span class="token punctuation">:</span> Install all dependencies<br>    <span class="token atrule key">cmds</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> npm ci<br>    <span class="token atrule key">status</span><span class="token punctuation">:</span><br>      <span class="token comment"># Lets check that node_modules exists</span><br>      <span class="token punctuation">-</span> test <span class="token punctuation">-</span>d node_modules<br>      <span class="token comment"># Finally, we are up to date if any files in node_modules are newer than package.json</span><br>      <span class="token punctuation">-</span> test <span class="token punctuation">-</span>n "$(find node_modules/ <span class="token punctuation">-</span>type f <span class="token punctuation">-</span>newer package.json)"</code></pre><p>Finally, let's test this out. The first run of <code>task build</code> will do the following:<pre class=language-bash><code class=language-bash>$ task build<br>task: <span class="token function">npm</span> ci<br><span class="token operator">></span> core-js@2.6.11 postinstall <span class="token punctuation">..</span>.<br><span class="token punctuation">..</span>.<br>task: <span class="token function">npm</span> run build<br><span class="token operator">></span> some_project@1.0.0 build <span class="token punctuation">..</span>.<br><span class="token punctuation">..</span>.</code></pre><p>On a second run the following happens though:<pre class=language-bash><code class=language-bash>$ task build<br>task: Task <span class="token string">"node_modules"</span> is up to <span class="token function">date</span><br>task: Task <span class="token string">"build"</span> is up to <span class="token function">date</span></code></pre><p>Any changes to <code>package.json</code> will result in the dependencies being installed again and then the build being rerun. Any change to any <code>src/</code> files will result in just the build being rerun. This can save a lot of time as builds are run over and over again.<h2>Conclusion</h2><p>Through this short guide, we've built a very clever, but easy to read and follow, set of tasks. These tasks are capable of documenting themselves allowing them to be easily read and understood. Additionally, the <code>status</code> and <code>sources</code> fields can be used to create tasks that only perform actions when they need to. We can chain these tasks together through the <code>deps</code> field. Chaining tasks in this manner can easily optimize a previously difficult task by breaking it into component parts and skipping any parts that do not need to be executed. We've seen this through two different examples - a contrived weather downloader and a more typical npm project. Through these examples, we've highlighted the power and convenience that <code>task</code> can provide. Anyone can easily benefit from using it, and hopefully, you can see why we love it at Shamaazi.</p><script src=https://ko-fi.com/widgets/widget_2.js type=text/javascript></script><script type=text/javascript>kofiwidget2.init('Support Me on Ko-fi', '#444', 'R6R72KTY9');kofiwidget2.draw();</script><share-widget><button aria-label=Share href=https://dgls.dev/posts/task-a-simple-automation-tool/ on-click=share><div></div></button></share-widget><script type=application/ld+json>{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "Task - An easy to use tool to simplify your build",
  "image": [],
  "author": "Douglas Parsons",
  "genre": "technology and programming",
  "publisher": {
    "@type": "Organization",
    "name": "Douglas Parsons",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/favicon/favicon-192x192.png?hash=1eead310e9"
    }
  },
  "url": "https://dgls.dev/posts/task-a-simple-automation-tool/",
  "mainEntityOfPage": "https://dgls.dev/posts/task-a-simple-automation-tool/",
  "datePublished": "2020-09-25",
  "dateModified": "2021-08-10",
  "description": "At Shamaazi we&#39;ve been using a tool called task. It&#39;s an incredibly powerful tool that can completely replace Makefiles (an old C build..."
}</script></article></main><footer><a href=/about/ >Douglas Parsons</a></footer>